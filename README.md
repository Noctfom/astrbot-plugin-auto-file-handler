# AstrBot自动文件处理器插件

![版本](https://img.shields.io/badge/版本-1.6.2-brightgreen) ![AstrBot](https://img.shields.io/badge/AstrBot-v4.0+-blue)

## 🌟 插件简介

这是一款专为AstrBot设计的多功能文件管理插件，旨在解决框架间在文件传输和处理方面的诸多限制。通过智能化的文件处理机制，本插件能够自动接收、存储、管理和处理用户发送的各种文件，特别针对长文本和代码文件进行了优化，有效突破消息平台输入长度限制。

## 💡 核心功能概述

本插件提供三大核心功能模块，全面覆盖文件处理的各个环节：

### 1. 📁 基础文件操作功能
- **自动接收文件** - 支持私聊和群聊文件自动接收
- **智能存储管理** - 按用户和群组分类存储文件
- **便捷文件操作** - 查看、发送、删除文件一体化操作
- **存储状态监控** - 实时查看文件存储使用情况

### 2. 🤖 智能Tools集成
- **LLM工具调用** - 无缝集成到AI对话中
- **智能文件定位** - AI可直接访问和操作存储的文件
- **上下文感知** - 根据对话内容智能推荐相关文件

### 3. 📖 主动读取文本功能（测试版）
- **智能文本处理** - 自动读取文本文件内容
- **长文本优化** - 智能截取和处理超长文本
- **AI无缝对接** - 直接将文件内容提交给AI处理，且保留人格与上下文，模拟用户输入
- **突破长度限制** - 完美解决QQ输入长度限制问题

> ⚠️ **注意**：主动读取文本功能目前仍在测试阶段，可能会与其他插件或功能产生冲突，请谨慎使用。如遇到问题请及时反馈。

## 📦 安装方法

### 自动安装（推荐）
在AstrBot插件平台中搜索并安装该插件。

### 手动安装
1. 下载插件包到AstrBot插件目录
2. 重启AstrBot服务
3. 插件将自动加载并初始化

## ⚙️ 配置说明

插件支持丰富的配置选项，可根据实际需求进行个性化设置。

### 📁 存储配置
- **storage_path**: 文件存储的根目录路径，默认为`/app/storage/auto_file_handler`

### 📖 文本处理配置
- **auto_read_content**: 是否自动读取文本文件内容，默认为`true`
- **max_auto_read_size**: 文本文件自动读取大小限制（字符数），默认为`2000`

### 🧹 自动清理配置
- **auto_cleanup_enabled**: 是否启用自动清理过期文件功能，默认为`true`
- **cleanup_days**: 自动清理多少天之前的文件，默认为`7`

### 📏 限制配置
- **max_file_size_mb**: 单个文件大小限制(MB)，默认为`100`
- **max_files_per_user**: 每个用户最大存储文件数量，默认为`5`
- **max_files_per_group**: 每个群最大存储文件数量，默认为`10`

### 👥 群组配置
- **group_whitelist**: 允许接收文件的群号列表，用逗号分隔，留空表示允许所有群
- **auto_receive_group_files**: 是否自动接收群文件，默认为`true`

### 🛠 系统配置
- **debug_mode**: 开启详细日志记录，用于问题排查，默认为`false`
- **send_completion_message**: 文件接收完成后是否发送提示消息，默认为`true`

## 📜 命令列表

插件提供以下10个命令，涵盖文件处理的各个方面：

- **/filestatus** - 查看文件存储状态和统计信息
- **/查看文件** - 查看个人文件列表
- **/发送文件** - 发送存储的个人文件
- **/删除文件** - 删除个人文件
- **/接收群文件** - 手动接收群文件
- **/查看群文件** - 查看群文件列表
- **/发送群文件** - 发送群文件
- **/删除群文件** - 删除群文件
- **/重置文件** - 重置个人文件存储
- **/重置群文件** - 重置群文件存储

> 💡 提示：所有命令均可通过添加 `-h` 参数查看详细帮助信息
>
> 📝 示例：`/查看文件 -h` 查看查看文件命令的帮助信息

## 🎯 详细功能说明

### 📁 基础文件操作功能 - 解决文件获取和存取问题

传统的QQ文件传输存在诸多不便，用户需要手动保存文件到本地，再进行后续处理。本插件的基础文件操作功能完美解决了这一痛点：

1. **全自动文件接收**
   - 私聊文件自动保存到个人目录
   - 群聊文件自动分类存储
   - 支持白名单控制，确保安全性

2. **智能存储管理**
   - 按用户ID和群号自动创建子目录
   - 文件命名去重机制，避免覆盖
   - 存储空间配额管理，防止无限增长

3. **便捷操作体验**
   - 通过简单命令即可查看所有文件
   - 支持按文件名模糊搜索
   - 一键发送和删除文件


### 🤖 智能Tools集成 - 解决AI文件定位问题

为了让AI能够更好地利用存储的文件，我们集成了智能Tools功能：

1. **无缝AI集成**
   - 文件列表可直接作为工具调用
   - AI可智能识别用户需求并推荐相关文件
   - 支持文件内容预览和摘要生成

2. **智能文件定位**
   - 根据对话上下文推荐相关文件
   - 支持按文件类型、时间等维度筛选
   - **LLM智能提示文件位置** - AI可直接告知用户文件存储的具体位置和访问方式
   - 提供文件元信息查询功能


## 📊 使用技巧

### 最佳实践
1. **合理配置存储限制** - 根据服务器存储空间合理设置文件大小和数量限制
2. **定期清理过期文件** - 启用自动清理功能或定期手动清理不需要的文件
3. **谨慎使用测试功能** - 在生产环境中谨慎使用主动读取文本等测试功能
4. **根据需求调整配置** - 根据实际使用场景调整max_auto_read_size等参数

### 故障排除
1. **检查存储路径权限** - 确保存储路径具有读写权限
2. **确认网络连接正常** - 文件接收需要稳定的网络连接
3. **查看日志文件** - 通过日志获取详细的错误信息
4. **验证配置项** - 检查配置文件是否正确设置

## 🔧 开发者信息
- **作者**: Noctfom
- **版本**: 1.6.2
- **许可证**: Apache-2.0 license
- **项目地址**: https://github.com/Noctfom/astrbot-plugin-auto-file-handler

##📞 支持
如有问题，请联系开发者qq：2721298904，加入交流群635990103（快来玩！）或提交Issue。

这里非常感谢插件AstrBot代码执行器插件 (Super Code Executor)https://github.com/luosheng520qaq/astrobot_plugin_code_executor项目的开发者
虽然我的项目代码并没有参考这个插件的源代码，但这个项目的80%都是由接入了这个插件的bot完成的....
再次对该插件的作者表达由衷的感激，没有Ta我很有可能不会做出这个插件。。。。

同时感谢Astrbot开源项目！！！

