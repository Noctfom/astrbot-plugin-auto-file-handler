# AstrBot自动文件处理器插件

![版本](https://img.shields.io/badge/版本-1.5.12-brightgreen)
![AstrBot](https://img.shields.io/badge/AstrBot-v4.0+-blue)

自动接收、存储和管理用户发送的文件，支持私聊和群聊场景。

## 🌟 主要功能

### 📥 文件自动接收
- **私聊文件**: 自动接收并存储用户发送的文件
- **群聊文件**: 支持自动接收或手动接收两种模式
- **智能命名**: 自动识别文件类型并生成合适的文件名
- **去重机制**: 避免重复文件存储

### 📊 文件管理
- **存储限制**: 可配置用户和群组的文件数量限制
- **大小控制**: 支持设置单文件大小限制
- **自动清理**: 可配置自动清理过期文件
- **群白名单**: 支持设置允许使用插件的群组

### 📤 文件发送
- **按需发送**: 支持通过命令发送存储的文件
- **灵活查找**: 支持按序号或文件名查找文件
- **批量操作**: 支持查看、删除文件等操作

### 🔧 调试支持
- **详细日志**: 开启调试模式可查看完整操作日志
- **URL追踪**: 记录文件下载URL信息
- **过程监控**: 详细记录文件处理各环节

## 📋 支持的文件类型

- **文档**: `.doc`, `.docx`, `.xls`, `.xlsx`, `.ppt`, `.pptx`, `.pdf`, `.txt`
- **压缩包**: `.zip`, `.rar`, `.7z`, `.tar`, `.gz`
- **图片**: `.jpg`, `.jpeg`, `.png`, `.gif`
- **程序**: `.exe`, `.py`, `.cpp`, `.java`, `.js`, `.php`, `.html`, `.css`
- **其他**: 二进制文件等

## 🚀 安装方法

1. 下载插件压缩包 `file_handler_v1.5.12.zip`
2. 解压到 AstrBot 的 `data/plugins/` 目录
3. 重启 AstrBot
4. 在管理面板中配置插件参数

## ⚙️ 配置说明

| 配置项 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| storage_path | string | `/app/storage/auto_file_handler` | 文件存储的根目录路径 |
| auto_cleanup_enabled | bool | `true` | 是否启用自动清理过期文件功能 |
| cleanup_days | int | `7` | 自动清理多少天之前的文件 |
| send_completion_message | bool | `true` | 文件接收完成后是否发送提示消息 |
| max_files_per_user | int | `5` | 每个用户最大存储文件数量 |
| max_file_size_mb | int | `100` | 单个文件大小限制(MB)，0表示无限制 |
| group_whitelist | string | `""` | 允许接收文件的群号列表，用逗号分隔，留空表示允许所有群 |
| auto_receive_group_files | bool | `true` | 是否自动接收群文件 |
| max_files_per_group | int | `10` | 每个群最大存储文件数量 |
| group_file_receive_timeout | int | `60` | 手动接收群文件时的超时时间（秒） |
| debug_mode | bool | `false` | 开启详细日志记录，用于问题排查 |

## 📡 使用命令

### 私聊命令

#### 查看文件
```
查看文件
/fileinfo
```
查看您发送的所有文件列表

#### 发送文件
```
发送文件 <序号>
发送文件 <文件名>
```
将存储的文件发送给您

#### 删除文件
```
删除文件 <序号>
删除文件 <文件名>
```
删除指定的文件

#### 重置文件
```
重置文件
```
清空您的所有文件记录

### 群聊命令

#### 查看群文件
```
查看群文件
```
查看本群的所有文件列表

#### 发送群文件
```
发送群文件 <序号>
发送群文件 <文件名>
```
将群文件发送到群聊

#### 删除群文件
```
删除群文件 <序号>
删除群文件 <文件名>
```
删除指定的群文件

#### 重置群文件
```
重置群文件
```
清空本群的所有文件记录（仅管理员）

#### 接收群文件
```
接收群文件
```
手动接收群文件（当自动接收关闭时使用）

## 🛠️ 技术特点

### 智能文件识别
- 基于文件头特征识别文件类型
- 支持多种办公文档格式
- 准确区分相似格式（如PPT/PPTX）

### 安全机制
- 文件大小限制防止滥用
- 存储空间配额管理
- 文件名安全过滤
- 自动清理过期文件

### 性能优化
- 异步文件下载
- 流式文件处理
- 内存优化设计
- 错误恢复机制

## 📝 使用示例

### 私聊使用
```
用户发送文件 → 自动存储 → 查看文件 → 发送文件给用户
```

### 群聊使用
```
群成员发送文件 → 自动存储 → 查看群文件 → 发送到群聊
```

## 🔧 调试模式

开启调试模式后，将在日志中显示：
- 文件接收详细过程
- 文件URL和下载信息
- 文件类型识别过程
- 存储路径和文件操作

## 📄 许可证

MIT License

## 👨‍💻 作者

Noctfom

## 📞 支持

如有问题，请联系开发者或提交Issue。
